<script>
    const NOTIFICACION_OK = 1;
    const NOTIFICACION_DANGER = 2;
    const NOTIFICACION_WARNING = 3;
    
    const mostrarTablaContactos = () => {
        if(document.getElementById('tablaContactos')) {
            crearNotificacion(NOTIFICACION_WARNING, "La tabla ya se esta mostrando", 'Atencion!')
            return;
        }

        google.script.run
            .withSuccessHandler(obj => construirTablaContactos(obj))
            .withFailureHandler(construirTablaContactosError)
            .obtenerContactos();
    }

    const construirTablaContactos = (obj) => {
        let tabla = document.createElement('table');
        tabla.id = 'tablaContactos';

        let tablaHeader = document.createElement('thead');
        let tablaBody = document.createElement('tbody');

        Array.from(obj).forEach((filaActual, i) => {
            let fila = document.createElement('tr');

            filaActual.forEach(celdaActual => {
                let celda = document.createElement('td');
                celda.textContent = celdaActual;
                fila.appendChild(celda);
            })
            
            if(i == 0) {
                tablaHeader.appendChild(fila);
                tabla.appendChild(tablaHeader);
            } else {
                tablaBody.appendChild(fila);
            }
            //i == 0? tabla.appendChild(tablaHeader.appendChild(fila)): tablaBody.appendChild(fila); => porque no funciona??
        })

        tabla.appendChild(tablaBody);

        tablaHeader.classList.add('table-dark');
        tabla.classList.add('table', 'table-striped', 'border', 'border-3', 'border-dark');

        document.getElementById("contactosContainer").appendChild(tabla);

        //Mostramos la notificacion de exito
        crearNotificacion(NOTIFICACION_OK, 'Contactos obtenidos correctamente', 'Todo en orden');
    }

    const construirTablaContactosError = () => {
        crearNotificacion(NOTIFICACION_DANGER, "Hubo un problema obteniendo los contactos", "Error!");
    }

    const crearNotificacion = (tipo, mensaje, titulo) => {
        //OBTENEMOS LOS DATOS
        let mensajeNotificacion = document.getElementById('notificacionMensaje');
        let tituloNotificacion = document.getElementById('notificacionTitulo');
        let iconoNotificacion = document.getElementById('notificacionIcono');
        
        //Obtenemos el elemento contenedor de la notificacion
        let notificacionElemento = document.getElementById('notificacion');

        //Instanciamos la notificacion
        let notificacion = bootstrap.Toast.getOrCreateInstance(notificacionElemento);

        //EDITAMOS LA NOTIFICACION
        mensajeNotificacion.textContent = mensaje;
        tituloNotificacion.textContent = titulo;
        
        if(tipo == NOTIFICACION_OK) {
            iconoNotificacion.className = '';
            iconoNotificacion.classList.add('bi', 'bi-check-circle');
            notificacionElemento.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-verde-oscuro');
        }

        if(tipo == NOTIFICACION_WARNING) {
            iconoNotificacion.className = '';
            iconoNotificacion.classList.add('bi', 'bi-question-circle');
            notificacionElemento.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-amarillo-oscuro');
        }

        if(tipo == NOTIFICACION_DANGER) {
            iconoNotificacion.className = '';
            iconoNotificacion.classList.add('bi', 'bi-exclamation-circle');
            notificacionElemento.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-rojo-oscuro');
        }

        //MOSTRAMOS LA NOTIFICACION
        notificacion.show();
    }

</script>